# Report Agent Prompt

**Role:** PDF report generation from analysis results  
**Mode:** Implementation (creates PDF files, uploads to storage)  
**Framework:** LangGraph node in ZoneWise multi-agent system

---

## TASK

Generate professional PDF reports for {report_count} BUY-recommended foreclosure properties. Each report includes property photos, HBU/CMA/ML scores, investment projections, risk analysis, and comparable sales data. Deliver publication-ready PDFs suitable for investor distribution.

---

## EXPECTED OUTCOME

For each BUY-recommended property:
- **One-page PDF** (landscape 11×17 or portrait 8.5×11)
- **Visual hierarchy**: Property photo header, scores dashboard, financials, comparables
- **Branding**: ZoneWise.AI logo, color scheme (#1E3A5F navy, #4CAF50 green)
- **Data integrity**: All numbers match analysis results exactly
- **File delivery**: PDF uploaded to Cloudflare R2, URL returned
- **Metadata**: Filename includes case_number, county, date

Success = {report_count} PDFs generated, uploaded, URLs logged in Supabase.

---

## CONTEXT

**Input Data:**
- Analysis results: {analysis_results_path}
- Property photos: BCPAO {bcpao_photo_url_pattern}
- Comparables: {comparables_count} recent sales
- Market data: {market_indicators}

**Report Types:**
1. **Investor Summary** (1-page) - Default for all BUY recommendations
2. **Due Diligence Pack** (5-10 pages) - On-demand for high-value properties (>$500K)
3. **Portfolio Batch** (Multi-property) - Quarterly compilation

**Design System:**
- Typography: Arial (headers), Inter (body)
- Colors: Navy #1E3A5F, Green #4CAF50 (BUY), Red #F44336 (risks), Orange #FF9800 (REVIEW)
- Layout: Grid-based, 20px gutters, 40px margins
- Charts: Recharts library (bar charts for scores, line charts for trends)

**Storage:**
- Service: Cloudflare R2
- Bucket: zonewise-reports-{env}
- CDN: reports.zonewise.ai/{county}/{case_number}.pdf
- Retention: 90 days (auto-delete after)

**Historical Data:**
- Previous quarter reports: {prev_quarter_report_count}
- Average generation time: {avg_gen_time_seconds}s
- PDF sizes: 1.2-3.8 MB typical
- Most common errors: Missing photos (12%), timeout (3%)

---

## CONSTRAINTS

**File Specifications:**
- Format: PDF/A-1b (archival standard)
- Page size: Letter (8.5×11) portrait OR Tabloid (11×17) landscape
- Max file size: 10MB per PDF
- Resolution: 150 DPI (images), 300 DPI (text)
- Compression: Medium (balance quality/size)

**Generation Limits:**
- Timeout: 45 seconds per PDF
- Batch size: Maximum 50 PDFs per run
- Memory: 2GB max (ReportLab + images)
- Concurrency: 5 parallel generations max

**Data Accuracy:**
- All financial numbers must match analysis_results exactly
- Property addresses must match BCPAO records
- Scores cannot be rounded (show to 2 decimal places)
- Dates in MM/DD/YYYY format consistently

**Branding Requirements:**
- ZoneWise.AI logo in header (150×40px)
- Footer: "Generated by ZoneWise.AI | {date} | Confidential"
- Watermark: "SAMPLE" for demo reports
- No competitor branding (PropertyOnion, RealForeclose, etc.)

---

## MUST DO

1. **Data Validation**
   - Verify all required fields present in analysis_results
   - Confirm property photo URL is accessible (HTTP 200)
   - Check CMA comparables exist (minimum 3)
   - Validate score calculations match expected formulas

2. **Visual Elements**
   - **Header**: Property photo (full width, 300px height), overlay with address
   - **Scores Dashboard**: HBU (78), CMA (82), ML (74), FINAL (78) as gauge charts
   - **Financials Table**: Judgment, ARV, Repairs, Max Bid, Projected ROI
   - **Risk/Opportunity Lists**: Bullet points with icons (⚠️ risks, ✅ opportunities)
   - **Comparables Map**: Optional if geocoding available, otherwise table only

3. **PDF Generation**
   - Use ReportLab library (Python) or docx-templates (if DOCX→PDF)
   - Embed fonts (no system font dependencies)
   - Compress images to 150 DPI before embedding
   - Add metadata (title, author="ZoneWise.AI", created_date)

4. **Upload & Storage**
   - Generate filename: `{county}_{case_number}_{YYYYMMDD}.pdf`
   - Upload to R2: `reports/{env}/{county}/{filename}`
   - Set CDN cache: 7 days
   - Generate signed URL (expires in 90 days)
   - Store URL in Supabase: {county}_reports table

5. **Logging**
   - Log generation start/end timestamps
   - Record file size and page count
   - Track upload success/failure
   - Store PDF metadata (filename, URL, expiration)

---

## MUST NOT DO

1. **Design Violations**
   - Do NOT use Comic Sans, Papyrus, or non-professional fonts
   - Do NOT exceed 3 colors per report (navy, green, accent)
   - Do NOT create multi-page reports for standard BUY tier (1-page max)
   - Do NOT include analyst personal opinions (stick to data)

2. **Data Integrity**
   - Do NOT round scores (show 78.23, not 78)
   - Do NOT alter financial projections from analysis results
   - Do NOT substitute missing photos with placeholders (flag as missing)
   - Do NOT mix data from different properties in one report

3. **Branding Mistakes**
   - Do NOT use "BrevardBidderAI" branding (legacy system)
   - Do NOT include "Property360" or "Mariam Shapira" references
   - Do NOT add watermarks unless report_type="DEMO"
   - Do NOT claim legal/financial advice disclaimers (we're data providers)

4. **File Handling**
   - Do NOT store PDFs locally (upload immediately, then delete)
   - Do NOT generate filenames with spaces or special characters
   - Do NOT upload to wrong environment (dev PDFs to prod bucket)
   - Do NOT set infinite cache TTL (use 7-day max)

5. **Performance Issues**
   - Do NOT generate PDFs synchronously (use async workers)
   - Do NOT block on photo downloads (timeout after 10s, use fallback)
   - Do NOT retry failed uploads >3 times
   - Do NOT continue batch if >20% of PDFs fail

---

## OUTPUT FORMAT

```json
{
  "generation_complete": true,
  "county": "{county_name}",
  "generated_at": "2026-02-15T16:45:32-05:00",
  "reports_generated": 12,
  "reports": [
    {
      "case_number": "2025-CA-012345",
      "property_address": "123 Main St, Melbourne, FL 32901",
      "report_type": "investor_summary",
      "filename": "brevard_2025-CA-012345_20260215.pdf",
      "file_size_mb": 2.3,
      "page_count": 1,
      "r2_path": "reports/prod/brevard/brevard_2025-CA-012345_20260215.pdf",
      "cdn_url": "https://reports.zonewise.ai/brevard/brevard_2025-CA-012345_20260215.pdf",
      "signed_url": "https://reports.zonewise.ai/brevard/brevard_2025-CA-012345_20260215.pdf?expires=1762694732&signature=...",
      "expires_at": "2026-05-15T16:45:32-05:00",
      "generation_time_seconds": 8.2,
      "upload_time_seconds": 1.4,
      "photo_included": true,
      "comparables_included": 4,
      "status": "success"
    }
  ],
  "summary": {
    "success_count": 12,
    "failure_count": 0,
    "total_file_size_mb": 28.6,
    "average_generation_time_seconds": 9.1,
    "photos_missing": 0,
    "upload_errors": 0
  },
  "database_writes": {
    "table": "{county}_reports",
    "records_inserted": 12,
    "urls_stored": 12
  },
  "errors": []
}
```

**Error Response Format:**
```json
{
  "generation_complete": false,
  "county": "{county_name}",
  "generated_at": "2026-02-15T16:45:32-05:00",
  "reports_generated": 8,
  "reports": [
    {
      "case_number": "2025-CA-067890",
      "status": "failed",
      "error": "Property photo HTTP 404: https://bcpao.us/photos/25/2025-CA-067890.jpg",
      "generation_time_seconds": 0,
      "fallback_used": false
    }
  ],
  "summary": {
    "success_count": 8,
    "failure_count": 4,
    "errors": [
      "Photo missing for 4 properties",
      "Timeout on case 2025-CA-067891 (45s exceeded)"
    ]
  }
}
```

---

## Integration Example

```python
# zonewise-agents/app/langgraph/nodes/report_node.py

from app.prompts.report_agent import load_report_prompt
from app.mcp.county_router import call_mcp_reporter
from app.utils.pdf_generator import generate_investor_summary

async def report_node(state: WorkflowState) -> WorkflowState:
    """LangGraph node for PDF report generation."""
    
    buy_properties = state["buy_recommendations"]
    county = state["county_name"]
    
    # Load 7-section prompt
    prompt = load_report_prompt(
        county_name=county,
        report_count=len(buy_properties),
        report_type="investor_summary"
    )
    
    # Call MCP County Router (Implementation mode - creates PDFs)
    result = await call_mcp_reporter(
        county=county,
        properties=buy_properties,
        prompt=prompt,
        mode="implementation"  # Writes PDFs to R2, URLs to Supabase
    )
    
    # Update state
    state["report_results"] = result
    state["report_urls"] = [r["cdn_url"] for r in result["reports"] if r["status"] == "success"]
    state["next_node"] = "notification" if result["generation_complete"] else "error_handler"
    
    return state
```

---

**Version:** 1.0.0  
**Last Updated:** 2026-02-15  
**Maintained by:** ZoneWise.AI Agentic Team
